#######################################################################
# Makefile for Fortran test-suite
#######################################################################

LANGUAGE	= fortran
FORTRAN		= @FORTRAN@
FC      	= @FC@
host		= @host@
SCRIPTSUFFIX	= _runme.f90

FORTRANOBJEXT = o

SO = @SO@

srcdir         = @srcdir@
top_srcdir     = @top_srcdir@
top_builddir   = @top_builddir@
abs_top_srcdir = @abs_top_srcdir@

# failed to compile wrapper
FAILING_CPP_TESTS += \
  apply_strings \
  cpp_basic \
  director_binary_string \
  dynamic_cast \
  extend \
  li_attribute \
  li_attribute_template \
  li_cdata_cpp \
  member_funcptr_galore \
  member_pointer \
  member_pointer_const \
  memberin_extend \
  namespace_spaces \
  namespace_typemap \
  operator_pointer_ref \
  smart_pointer_const_overload \
  special_variable_macros \
  template_basic \
  template_explicit \
  typedef_struct_cpp \
  typemap_various

# failed to compile fortran
FAILING_CPP_TESTS += \
  abstract_signature \
  allprotected \
  arrays_dimensionless \
  arrays_global \
  arrays_scope \
  autodoc \
  bloody_hell \
  char_strings \
  constructor_copy \
  contract \
  cpp_enum \
  default_constructor \
  director_basic \
  director_classes \
  director_default \
  director_detect \
  director_enum \
  director_frob \
  director_ignore \
  director_keywords \
  director_nested \
  director_overload2 \
  director_property \
  director_protected \
  enum_ignore \
  enum_scope_template \
  enum_thorough \
  evil_diamond_prop \
  extend_default \
  fvirtual \
  global_namespace \
  global_vars \
  inherit_target_language \
  li_boost_shared_ptr \
  mixed_types \
  multiple_inheritance \
  multiple_inheritance_abstract \
  multiple_inheritance_interfaces \
  multiple_inheritance_nspace \
  multiple_inheritance_shared_ptr \
  name_warnings \
  namespace_class \
  namespace_nested \
  nested_scope \
  nested_workaround \
  operator_overload \
  operator_overload_break \
  overload_arrays \
  overload_method \
  overload_return_type \
  overload_simple \
  overload_subtype \
  overload_template \
  overload_template_fast \
  preproc_constants \
  refcount \
  return_const_value \
  smart_pointer_inherit \
  smart_pointer_rename \
  smart_pointer_template_const_overload \
  smart_pointer_template_defaults_overload \
  special_variables \
  template_arg_typename \
  template_default_arg \
  template_enum \
  template_extend_overload \
  template_methods \
  template_ns \
  template_ref_type \
  template_specialization_enum \
  template_typedef_inherit \
  typemap_ns_using \
  using1 \
  using2 \
  using_composition \
  using_extend \
  using_inherit \
  using_protected \
  valuewrapper_base \
  variable_replacement \
  virtual_poly \
  wallkw

include $(srcdir)/../common.mk

.SUFFIXES: .cpptest .ctest .multicpptest

# Rules for the different types of tests
%.cpptest:
	$(setup)
	+$(swig_and_compile_cpp)
	$(run_testcase_cpp)

%.ctest:
	$(setup)
	+$(swig_and_compile_c)
	$(run_testcase_cpp)

%.multicpptest:
	$(setup)
	+$(swig_and_compile_multi_cpp)
	$(run_testcase_cpp)

# Runs the testcase.
run_testcase_cpp = \
	if test -f $(SCRIPTDIR)/$(SCRIPTPREFIX)$*$(SCRIPTSUFFIX); then \
	    $(COMPILETOOL) $(FORTRAN) $*.f90 -c; \
	    $(COMPILETOOL) $(FORTRAN) $(SCRIPTDIR)/$(SCRIPTPREFIX)$*$(SCRIPTSUFFIX) -c; \
	    $(COMPILETOOL) $(FORTRAN) -o $*_runme $(SCRIPTPREFIX)$*.@OBJEXT@ $(SCRIPTPREFIX)$*_runme.@OBJEXT@ $*.so; \
	  env LD_LIBRARY_PATH=.:$$LD_LIBRARY_PATH $(RUNTOOL) ./$*_runme; \
	fi

%.clean:
	@rm -rf $*.o $*.a

cvsignore:
	@echo Makefile
